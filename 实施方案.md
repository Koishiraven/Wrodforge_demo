# AI写作伴侣 Demo 实施方案（1 天前端验证）

## 默认假设
- 只做 PC Web 前端 Demo，用于论证“卡片互动逻辑 + 生成闭环”是否成立
- 不依赖真实后端；允许本地数据与 Mock 兜底，确保任何环境都能演示
- 保留多卡片类型；不做自动连线（不提供连线入口与交互）
- 优先级：互动逻辑成立 > 能稳定生成情节卡 > 视觉美观

## 本次要交付的产物清单
- 一个可运行的前端原型：中央画布（线索板）+ 底部篮子 + 右侧编辑/生成面板 + 顶部工具条
- 多卡片类型：角色卡 / 事件卡 / 设定卡 / 情节卡（生成结果）
- 核心闭环：加入篮子 → 微调 → 生成预览 → 采纳生成情节卡 → 放回画布（并可拖到时间参考线附近）
- 关键状态齐全：空态/加载态/错误态/重试/兜底提示（演示模式）

## 技术选型（以“最快交付可演示”为原则）
- 框架：React + Vite + TypeScript
- 画布：React Flow（快速拿到无限画布、缩放、拖拽、选择）
- 状态：Zustand（或 React Context + useReducer；以实现速度为准）
- 样式：优先 Tailwind（新项目最快）；若后续要更可维护可换 CSS Modules
- 生成：前端 fetch 调用 OpenAI 兼容接口；同时内置 Mock 生成器做兜底

## 方案妥当性复核（原方案的细节问题与修订）

### 1) 在卡片节点内直接用 textarea 编辑
- 问题：输入框与拖拽/缩放/选择手势冲突，容易耗时调事件，且手感不稳定
- 修订：节点只展示摘要；所有字段与正文编辑统一放到右侧面板

### 2) “拖入篮子”作为主路径
- 问题：画布有缩放/平移变换，节点坐标与屏幕坐标转换易踩坑；跨容器拖拽会显著拉长工期
- 修订：篮子主路径用“点击加入/移除”（卡片按钮或右侧面板按钮）；拖入篮子只作为有空再做的增强

### 3) 单一“文本卡片”不利于验证产品差异
- 问题：无法验证“角色/事件/设定”分类型对生成质量和组织结构的帮助
- 修订：保留四类卡片，但字段极简，保证在一天内可做完且区分清晰

### 4) 生成输出仅纯文本可控性不足
- 问题：标题/时间/地点/摘要缺失或漂移，影响“放回画布”后的组织与复用
- 修订：要求模型优先返回结构化 JSON（title/timeHint/placeHint/summary/content）；解析失败时降级为纯文本并提示

### 5) 真实模型调用不可用会导致 Demo 失败
- 问题：Key/CORS/断网/限流都可能让“生成”不可演示
- 修订：双通道：真实调用失败自动切 Mock，并在 UI 标注“演示模式”

## MVP 范围（做 / 不做）

| 模块 | ✅ 必须做 | ❌ 不做 | 说明 |
| :--- | :--- | :--- | :--- |
| 线索板（画布） | 无限画布、缩放、拖拽、选中 | 自动连线/关系网络 | 不显示连接点，不提供边编辑 |
| 卡片类型 | 角色/事件/设定/情节四类 | 模板可自定义字段 | 字段极简，先验证分类型价值 |
| 编辑方式 | 右侧面板编辑选中卡片 | 节点内直接编辑 | 规避手势冲突与返工 |
| 篮子 | 点击加入/移除、上限 5、清空 | 跨容器拖拽做精致动画 | 有空再加“拖入篮子高亮区”增强 |
| 生成 | 预览、重试、采纳生成情节卡 | 复杂微调参数面板 | 只保留“微调一句话” |
| 时间参考线 | 视觉引导 + 最小规则标签 | 自动吸附/时间推断 | 左=过去，右=未来，显示角标 |

## 页面信息架构与交互流程

### 页面布局
- 顶部：新建卡片（选择类型）/重置示例数据/生成状态
- 中央：画布（多类型卡片，以颜色/徽标区分）
- 底部：篮子缩略条（类型 + 标题、上限提示）
- 右侧：选中卡片编辑 + 篮子摘要 + 微调输入 + 生成预览与操作

### 一次完整生成流程
1. 选择 2–5 张卡片加入篮子（点击加入为主）
2. 输入微调（可空）
3. 点击生成 → 进入 loading
4. 成功：展示预览（支持“重新生成”）
5. 采纳：生成一张情节卡插入画布中央，可拖到时间参考线附近
6. 失败：展示错误信息，提供重试；若真实调用失败则自动切 Mock

## 数据与类型（Demo 级，不做复杂后端）

### 卡片类型（字段极简）
- 角色卡：title / age? / traits? / goal? / secret? / notes
- 事件卡：title / time? / place? / participants? / conflict? / notes
- 设定卡：title / domain? / rule? / keyword? / notes
- 情节卡：title / timeHint? / placeHint? / summary? / content / sourceCardIds

### 状态模型（建议）
- cards：画布卡片集合（含 position 与 type）
- selectedCardId：当前选中卡片
- basketCardIds：篮子卡片 id（有序，上限 5）
- generate：mode（idle|generating|success|error）、instruction、lastRequest、result、errorMessage、isMock

## 生成契约（前端接口约定 + 兜底）

### 输入（前端组装）
- basketCards：按类型结构化摘要（不要只用逗号拼接）
- instruction：微调一句话（可空）
- constraints：200–300 字，贴合卡片信息，不新增重大设定（除非设定卡允许）

### 输出（优先结构化）
- 成功：{ title, timeHint?, placeHint?, summary?, content }
- 失败：{ code: NETWORK|TIMEOUT|PROVIDER|FORMAT, message }
- 降级：结构化解析失败 → 使用纯文本 content 并给默认 title（例如“未命名情节”）

## 8 小时工期拆分（确保 1 天可完成）
- 09:00–10:30：项目初始化与页面骨架（布局 + 画布能显示卡片）
- 10:30–12:00：多类型卡片与右侧面板编辑（创建/选中/编辑）
- 13:00–14:30：篮子逻辑（点击加入/移除/上限/清空/摘要展示）
- 14:30–16:00：生成闭环（loading/预览/重试/采纳生成情节卡/插入画布）
- 16:00–17:00：时间参考线与最小规则角标（过去/未来）
- 17:00–18:00：视觉统一与演示数据（状态文案、禁用态、间距、阴影）

## 验收清单（演示脚本）
- 打开页面即有示例卡片（角色 2、设定 1、事件 1）
- 能拖拽/缩放/选中卡片，类型区分清晰
- 能创建任意类型卡片，并在右侧面板编辑字段
- 能把卡片加入篮子（上限 5 生效且提示清晰）
- 能生成预览并采纳生成情节卡回到画布（断网时也能用 Mock 演示）
